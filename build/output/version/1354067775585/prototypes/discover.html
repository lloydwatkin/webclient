<!doctype html>
<html lang="en">
<head>
  <title>buddycloud Discover</title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <link rel="stylesheet" href="/css/main.css" type="text/css" media="screen">
  <script src="/js/vendor/jquery.js"></script>
  <script src="/js/vendor/modernizr.js"></script>
</head>
<body>
  <div class="sidebar">
    <div class="personal channel">
      <div class="avatar" style="background-image: url(avatars/user1.jpg)">
        <span class="channelpost counter">2</span>
        <span class="message counter">2</span>
      </div>
      <div class="info">
        <span class="owner">felix<span class="domain">@buddycloud.com</span></span>
        <span class="status">Aww yeah, Lion rocks</span>
      </div>
    </div>
    <nav class="actionBar clearfix">
      <button class="discover"><span>Find Channels</span></button>
    </nav>
    <div class="channels" class="antiscroll-wrap">
      <div class="antiscroll-inner scrollHolder">
        <div class="channel">
          <div class="avatar" style="background-image: url(avatars/user2.jpg)">
            <span class="channelpost counter">2</span>
          </div>
          <div class="info">
            <span class="owner">vera<span class="domain">@buddycloud.com</span></span>
            <span class="status">What a wonderful day</span>
          </div>
        </div>
        <div class="channel">
          <div class="avatar" style="background-image: url(avatars/channel2.jpg)">
            <span class="channelpost counter admin">1</span>
          </div>
          <div class="info">
            <span class="owner">moviefans<span class="domain">@buddycloud.com</span></span>
            <span class="status">Harry Potter, tonight!</span>
          </div>
        </div>
        <div class="channel">
          <div class="avatar" style="background-image: url(avatars/channel3.jpg)">
            <span class="channelpost counter admin">1</span>
          </div>
          <div class="info">
            <span class="owner">on-the-box<span class="domain">@bbc.co.uk</span></span>
            <span class="status">You gonna love the new Dexter episodes</span>
          </div>
        </div>
        <div class="channel">
          <div class="avatar" style="background-image: url(avatars/topic.png)">
            <span class="channelpost counter">2</span>
          </div>
          <div class="info">
            <span class="owner">lolcats<span class="domain">@buddycloud.com</span></span>
            <span class="status">I can haz your nose?</span>
          </div>
        </div>
        <div class="channel">
          <div class="avatar" style="background-image: url(avatars/user4.jpg)">
          </div>
          <div class="info">
            <span class="owner">martin<span class="domain">@buddycloud.com</span></span>
            <span class="status">working on the webgl project</span>
          </div>
        </div>
        <div class="channel">
          <div class="avatar" style="background-image: url(avatars/topic.png)">
          </div>
          <div class="info">
            <span class="owner">music<span class="domain">@buddycloud.com</span></span>
            <span class="status">New Foo Fighter Album online - check it out!</span>
          </div>
        </div>
        <div class="channel">
          <div class="avatar" style="background-image: url(avatars/user7.jpg)">
          </div>
          <div class="info">
            <span class="owner">verena<span class="domain">@buddycloud.com</span></span>
            <span class="status">test's are over - party!!!</span>
          </div>
        </div>
        <div class="channel">
          <div class="avatar" style="background-image: url(avatars/channel7.jpg)">
          </div>
          <div class="info">
            <span class="owner">fans<span class="domain">@steam.com</span></span>
            <span class="status">the cake is a lie!</span>
          </div>
        </div>
        <div class="channel">
          <div class="avatar" style="background-image: url(avatars/channel8.jpg)">
          </div>
          <div class="info">
            <span class="owner">cave<span class="domain">@minecraft.com</span></span>
            <span class="status">Buy minecraft - now!</span>
          </div>
        </div>
        <div class="channel">
          <div class="avatar" style="background-image: url(avatars/anon.png)">
            <span class="channelpost counter">2</span>
          </div>
          <div class="info">
            <span class="owner">steve<span class="domain">@buddycloud.com</span></span>
            <span class="status">all your base belongs to us</span>
          </div>
        </div>
        <div class="channel">
          <div class="avatar" style="background-image: url(avatars/channel2.jpg)">
            <span class="channelpost counter admin">1</span>
          </div>
          <div class="info">
            <span class="owner">moviefans<span class="domain">@buddycloud.com</span></span>
            <span class="status">Harry Potter, tonight!</span>
          </div>
        </div>
        <div class="channel">
          <div class="avatar" style="background-image: url(avatars/channel3.jpg)">
            <span class="channelpost counter admin">1</span>
          </div>
          <div class="info">
            <span class="owner">on-the-box<span class="domain">@bbc.co.uk</span></span>
            <span class="status">You gonna love the new Dexter episodes</span>
          </div>
        </div>
        <div class="channel">
          <div class="avatar" style="background-image: url(avatars/channel4.jpg)">
            <span class="channelpost counter">2</span>
          </div>
          <div class="info">
            <span class="owner">lolcats<span class="domain">@buddycloud.com</span></span>
            <span class="status">I can haz your nose?</span>
          </div>
        </div>
        <div class="channel">
          <div class="avatar" style="background-image: url(avatars/user4.jpg)">
          </div>
          <div class="info">
            <span class="owner">martin<span class="domain">@buddycloud.com</span></span>
            <span class="status">working on the webgl project</span>
          </div>
        </div>
        <div class="channel">
          <div class="avatar" style="background-image: url(avatars/channel6.jpg)">
          </div>
          <div class="info">
            <span class="owner">music<span class="domain">@buddycloud.com</span></span>
            <span class="status">New Foo Fighter Album online - check it out!</span>
          </div>
        </div>
        <div class="channel">
          <div class="avatar" style="background-image: url(avatars/user7.jpg)">
          </div>
          <div class="info">
            <span class="owner">verena<span class="domain">@buddycloud.com</span></span>
            <span class="status">test's are over - party!!!</span>
          </div>
        </div>
        <div class="channel">
          <div class="avatar" style="background-image: url(avatars/channel7.jpg)">
          </div>
          <div class="info">
            <span class="owner">fans<span class="domain">@steam.com</span></span>
            <span class="status">the cake is a lie!</span>
          </div>
        </div>
        <div class="channel">
          <div class="avatar" style="background-image: url(avatars/channel8.jpg)">
          </div>
          <div class="info">
            <span class="owner">cave<span class="domain">@minecraft.com</span></span>
            <span class="status">Buy minecraft - now!</span>
          </div>
        </div>
      </div><!-- /antiscroll-inner -->
    </div><!-- /channels -->
  </div>
  <div class="content">
    <div class="searchbar">
      <form class="centered span-2">
        <input type="search" name="search" placeholder="Find Channels and Posts" class="withButton" autofocus>
        <input type="submit" value="Search" class="search button">
      </form>
    </div>
      <div class="discoverChannels clearfix">
        <div class="local span-2">
          <h1>Local</h1>
          <div class="mostActive span-1">
            <h2>Most Active</h2>
            <div class="list">
              <div class="channel justify">
                <div class="avatar" style="background-image: url(avatars/user12.jpg)"></div>
                <div class="info flex">
                  <span class="owner">Franz</span>
                  <span class="about">Hanging out at starbucks</span>
                </div>
                <div class="follow button callToAction">Follow</div>
              </div>
              <div class="channel justify">
                <div class="avatar" style="background-image: url(avatars/user11.jpg)"></div>
                <div class="info flex">
                  <span class="owner">Lisa</span>
                  <span class="about">Where is the love?</span>
                </div>
                <div class="follow button callToAction">Follow</div>
              </div>
              <div class="channel justify">
                <div class="avatar" style="background-image: url(avatars/user13.jpg)"></div>
                <div class="info flex">
                  <span class="owner">Ralf</span>
                  <span class="about">Ich bin ein Berliner!</span>
                </div>
                <div class="follow button callToAction">Follow</div>
              </div>
              <div class="channel justify">
                <div class="avatar" style="background-image: url(avatars/user6.jpg)"></div>
                <div class="info flex">
                  <span class="owner">Steffi</span>
                  <span class="about">Listening to Fuadadeimuada</span>
                </div>
                <div class="follow button callToAction">Follow</div>
              </div>
              <div class="channel justify">
                <div class="avatar" style="background-image: url(avatars/user7.jpg)"></div>
                <div class="info flex">
                  <span class="owner">Anna</span>
                  <span class="about">First Season of Game of Thrones was a blast!</span>
                </div>
                <div class="follow button callToAction">Follow</div>
              </div>
            </div>
          </div>
          <div class="popular span-1">
            <h2>Popular</h2>
            <div class="list">
              <div class="channel justify">
                <div class="avatar" style="background-image: url(avatars/user1.jpg)"></div>
                <div class="info flex">
                  <span class="owner">mrflix</span>
                  <span class="about">I don't like cinema</span>
                </div>
                <div class="follow button disabled">Follow</div>
              </div>
              <div class="channel justify">
                <div class="avatar" style="background-image: url(avatars/user4.jpg)"></div>
                <div class="info flex">
                  <span class="owner">Martin</span>
                  <span class="about">Handed in my thesis. Like a boss.</span>
                </div>
                <div class="follow button callToAction">Follow</div>
              </div>
              <div class="channel justify">
                <div class="avatar" style="background-image: url(avatars/user2.jpg)"></div>
                <div class="info flex">
                  <span class="owner">Vera</span>
                  <span class="about">Munich here I come.</span>
                </div>
                <div class="follow button callToAction">Follow</div>
              </div>
              <div class="channel justify">
                <div class="avatar" style="background-image: url(avatars/user3.jpg)"></div>
                <div class="info flex">
                  <span class="owner">Tom</span>
                  <span class="about">Island is great. Let's make music</span>
                </div>
                <div class="follow button callToAction">Follow</div>
              </div>
              <div class="channel justify">
                <div class="avatar" style="background-image: url(avatars/user5.jpg)"></div>
                <div class="info flex">
                  <span class="owner">Josef</span>
                  <span class="about">Desmond Myers really knows how to rap</span>
                </div>
                <div class="follow button callToAction">Follow</div>
              </div>
            </div>
          </div>
        </div>
        <div class="global span-2">
          <h1>Global</h1>
          <div class="mostActive span-1">
            <h2>Most Active</h2>
            <div class="list">
              <div class="channel justify">
                <div class="avatar" style="background-image: url(avatars/user12.jpg)"></div>
                <div class="info flex">
                  <span class="owner">Franz</span>
                  <span class="about">Hanging out at starbucks</span>
                </div>
                <div class="follow button callToAction">Follow</div>
              </div>
              <div class="channel justify">
                <div class="avatar" style="background-image: url(avatars/user11.jpg)"></div>
                <div class="info flex">
                  <span class="owner">Lisa</span>
                  <span class="about">Where is the love?</span>
                </div>
                <div class="follow button callToAction">Follow</div>
              </div>
              <div class="channel justify">
                <div class="avatar" style="background-image: url(avatars/user13.jpg)"></div>
                <div class="info flex">
                  <span class="owner">Ralf</span>
                  <span class="about">Ich bin ein Berliner!</span>
                </div>
                <div class="follow button callToAction">Follow</div>
              </div>
              <div class="channel justify">
                <div class="avatar" style="background-image: url(avatars/user6.jpg)"></div>
                <div class="info flex">
                  <span class="owner">Steffi</span>
                  <span class="about">Listening to Fuadadeimuada</span>
                </div>
                <div class="follow button callToAction">Follow</div>
              </div>
              <div class="channel justify">
                <div class="avatar" style="background-image: url(avatars/user7.jpg)"></div>
                <div class="info flex">
                  <span class="owner">Anna</span>
                  <span class="about">First Season of Game of Thrones was a blast!</span>
                </div>
                <div class="follow button callToAction">Follow</div>
              </div>
            </div>
          </div>
          <div class="popular span-1">
            <h2>Popular</h2>
            <div class="list">
              <div class="channel justify">
                <div class="avatar" style="background-image: url(avatars/user1.jpg)"></div>
                <div class="info flex">
                  <span class="owner">mrflix</span>
                  <span class="about">I don't like cinema</span>
                </div>
                <div class="follow button disabled">Follow</div>
              </div>
              <div class="channel justify">
                <div class="avatar" style="background-image: url(avatars/user4.jpg)"></div>
                <div class="info flex">
                  <span class="owner">Martin</span>
                  <span class="about">Handed in my thesis. Like a boss.</span>
                </div>
                <div class="follow button callToAction">Follow</div>
              </div>
              <div class="channel justify">
                <div class="avatar" style="background-image: url(avatars/user2.jpg)"></div>
                <div class="info flex">
                  <span class="owner">Vera</span>
                  <span class="about">Munich here I come.</span>
                </div>
                <div class="follow button">Follow</div>
              </div>
              <div class="channel justify">
                <div class="avatar" style="background-image: url(avatars/user3.jpg)"></div>
                <div class="info flex">
                  <span class="owner">Tom</span>
                  <span class="about">Island is great. Let's make music</span>
                </div>
                <div class="follow button callToAction">Follow</div>
              </div>
              <div class="channel justify">
                <div class="avatar" style="background-image: url(avatars/user5.jpg)"></div>
                <div class="info flex">
                  <span class="owner">Josef</span>
                  <span class="about">Desmond Myers really knows how to rap</span>
                </div>
                <div class="follow button callToAction">Follow</div>
              </div>
            </div>
          </div>
        </div>
        <div class="location span-1">
          <h1>Location</h1>
          <div class="nearby span-1">
            <h2>Nearby</h2>
            <div class="list">
              <div class="channel justify">
                <div class="avatar" style="background-image: url(avatars/user12.jpg)"></div>
                <div class="info flex">
                  <span class="owner">Franz</span>
                  <span class="about">Hanging out at starbucks</span>
                </div>
                <div class="follow button">Follow</div>
              </div>
              <div class="channel justify">
                <div class="avatar" style="background-image: url(avatars/user11.jpg)"></div>
                <div class="info flex">
                  <span class="owner">Lisa</span>
                  <span class="about">Where is the love?</span>
                </div>
                <div class="follow button">Follow</div>
              </div>
              <div class="channel justify">
                <div class="avatar" style="background-image: url(avatars/user13.jpg)"></div>
                <div class="info flex">
                  <span class="owner">Ralf</span>
                  <span class="about">Ich bin ein Berliner!</span>
                </div>
                <div class="follow button">Follow</div>
              </div>
              <div class="channel justify">
                <div class="avatar" style="background-image: url(avatars/user6.jpg)"></div>
                <div class="info flex">
                  <span class="owner">Steffi</span>
                  <span class="about">Listening to Fuadadeimuada</span>
                </div>
                <div class="follow button">Follow</div>
              </div>
              <div class="channel justify">
                <div class="avatar" style="background-image: url(avatars/user7.jpg)"></div>
                <div class="info flex">
                  <span class="owner">Anna</span>
                  <span class="about">First Season of Game of Thrones was a blast!</span>
                </div>
                <div class="follow button">Follow</div>
              </div>
            </div>
          </div>
        </div>
      </div>
  </div><!-- /content -->
<script type="text/javascript">
  /* ###
  
  redraw function to make sure that transitions are triggered 
  
  ### */
  !function(document){

      // (C) WebReflection (As It Is) - Mit Style

      // we all love function declarations
      function redraw() {

          // clientHeight returns 0 if not present in the DOM
          // e.g. document.removeChild(document.documentElement);
          // also some crazy guy may swap runtime the whole HTML element
          // this is why the documentElement should be always discovered
          // and if present, it should be a node of the document
          // In all these cases the returned value is true
          // otherwise what is there cannot really be considered as painted

          return !!(document.documentElement || 0).clientHeight;
      }

      // ideally an Object.defineProperty
      // unfortunately some engine will complain
      // if used against DOM objects
      document.redraw = redraw;

  }(document);
  
  /* ###
  
    Channel bubbling
  
    ### */
  var channelHolder = $('.channels');
  var innerHolder = channelHolder.find('.scrollHolder');
  var channels = channelHolder.find('.channel:not(".personal")');
  
  // prefixes for cutting edge css properties and javascript events:
  //
  //  transition => MozTransition
  var transition = Modernizr.prefixed('transition');
  //  transform => MozTransform
  var transform = Modernizr.prefixed('transform');
  var transEndEventNames = {
      'WebkitTransition' : 'webkitTransitionEnd',
      'MozTransition'    : 'transitionend',
      'OTransition'      : 'oTransitionEnd',
      'msTransition'     : 'msTransitionEnd', // maybe?
      'transition'       : 'transitionEnd'
  }
  //  transitionendEvent => transitionend
  var transitionendEvent = transEndEventNames[ transition ];
  // cache channelHeight - it's the same for every channel-preview
  var channelHeight = channels.first().outerHeight();
  // count of currently moving channels
  var movingChannels = 0;
  
  /*
  
  Stress test:
  
  $('.channel:not(".personal")').each(function(i, channel){
      setTimeout( function(){ $(this).click() }.bind(this), i*250);
  });
  
  Reality test:
  
  $('.channel:not(".personal")').each(function(i, channel){
      setTimeout( function(){ $(this).click() }.bind(this), i*Math.round(Math.random()*2500));
  });
  
  An even more real test:
  
  time = 5000;
  
  function goCrazy(){
  var allChannels = $('.channel:not(".personal")');
  allChannels.eq( Math.round( Math.random()*allChannels.size() ) ).click();
    timer = setTimeout(goCrazy, Math.random()*time);
  }
  goCrazy();
  
  */
  
  function bubble(){
    var bubblingChannel = $(this);
    
    // relative offset + absolute offset 
    var offset = bubblingChannel.position().top + innerHolder.scrollTop();
    
    // don't bubble if the channel is..
    //  - on top
    //  - bubbling
    if(offset === 0 || bubblingChannel.parent().hasClass('bubbleHolder')) {
      return false;
    }
    
    // create a gap where the channel starts off
    var startingArea = $('<div>').height( channelHeight ).addClass('startingArea');
    bubblingChannel.before( startingArea );
    
    document.redraw();
    
    startingArea.bind(transitionendEvent, destroy);
    
    // close startingArea
    startingArea.css('height', 0);
    
    // detach the bubbling channel from the DOM
    // and insert it at the top
    bubblingChannel.detach().css('top', offset);
    innerHolder.prepend(bubblingChannel);
    
    // wrap a growing holder around it
    var landingArea = $('<div>').addClass('bubbleHolder');
    bubblingChannel.wrap(landingArea);
    
    document.redraw();
    
    // bind the callback on transition end for all bubbling channels
    bubblingChannel.one(transitionendEvent, reset);
    
    // bubble!
    bubblingChannel.css({ 'top' : 0, 'z-index' : ++movingChannels+1 });
    // open a gap for the channel to arrive
    bubblingChannel.parent().css('height', channelHeight);
  }
  
  function destroy(){
    // remove the gap-div
    $(this).remove();
  }
  
  function reset(event){
    if(event.data && event.data.callback) event.data.callback();
    // reset the bubbling channel and unwrap it
    $(this).removeClass('bubbling').css({ 'height' : '', 'z-index' : '' }).unwrap();
    movingChannels--;
  }
  
  channelHolder.on('click', '.channel', bubble);
  //channels.toggle(function(){ $(this).css('background', 'red'); }, function(){ $(this).css('background', 'green'); });
  
  /* ###
  
    follow
    
  ### */
  
  function channelTemplate(avatarUrl, owner, status, animationClassName){
    return $('<div class="channel">')
      .addClass(animationClassName ? animationClassName : "")
      .append(
        $('<div class="avatar">').css('background-image', avatarUrl)
      )
      .append(
        $('<div class="info">')
          .append(
            $('<div class="owner">').text(owner)
          )
          .append(
            $('<div class="status">').text(status)
          )
      );
  }
  
  var discoverChannels = $('.discoverChannels');
  
  discoverChannels.on('click', '.follow:not(.disabled)', follow);
  
  function follow(){
    $(this).addClass('disabled');
    
    var avatarUrl = $(this).siblings('.avatar').css('background-image');
    var owner = $(this).siblings().children('.owner').text();
    // the status will not be visible in the discovery
    // using the about for now
    var status = $(this).siblings().children('.about').text();
    var animationClassName = 'rainbow';
    
    // create new channel from template for the sidebar
    var newChannel = new channelTemplate(avatarUrl, owner, status, animationClassName);
    
    // get the start offset
    var offset = $(this).parent().offset();
    var callback = function(){ 
      $('.channels').removeClass('rainbowAnimationRunning');
      $(this).css({ left: '', top: '' });
    }.bind(newChannel);
    
    $('.channels').addClass('rainbowAnimationRunning');
    
    // start the animation
    rainbowAnimation(newChannel, offset, animationClassName, callback);
  }

  function rainbowAnimation(channel, offset, animationClassName, callback){
    channel.css({
      left : offset.left - innerHolder.offset().left,
      top : offset.top - innerHolder.offset().top
    });
    innerHolder.prepend(channel);

    // wrap a growing holder around it
    var landingArea = $('<div>').addClass('bubbleHolder rainbowBubble');
    channel.wrap(landingArea);

    document.redraw();

    // bind the callback on transition end for all bubbling channels
    channel.one(transitionendEvent, { callback : callback }, reset);

    // bubble!
    channel.removeClass(animationClassName).css({ 'top' : 0, 'left' : 0, 'z-index' : ++movingChannels+1 });
    // open a gap for the channel to arrive
    channel.parent().css('height', channelHeight);
  }
</script>
</body>
</html>
